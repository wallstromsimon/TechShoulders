---
import BaseLayout from '../layouts/BaseLayout.astro';
import InfluenceGraph from '../components/InfluenceGraph';
import type { NodeKind, EdgeKind } from '../lib/data';

// Load precomputed graph data generated at build time
import graphData from '../../public/graph.json';

// Type the precomputed data properly
const graphNodes = graphData.nodes as {
  id: string;
  name: string;
  kind: NodeKind;
  domains: string[];
}[];
const graphEdges = graphData.edges as {
  source: string;
  target: string;
  kind: EdgeKind;
  label?: string;
  year?: number;
}[];

// Get all unique domains for filter dropdown
const allDomains = [...new Set(graphNodes.flatMap((n) => n.domains || []))].sort();
---

<BaseLayout title="Influence Graph">
  <h1>Influence Graph</h1>
  <p style="margin-bottom: 1.5rem; color: #666; max-width: 680px;">
    Trace the web of influence behind computing's greatest innovations. Use the search box to find
    any person, project, or institution, then explore their neighborhood.
  </p>

  <InfluenceGraph client:load nodes={graphNodes} edges={graphEdges} allDomains={allDomains} />
</BaseLayout>
