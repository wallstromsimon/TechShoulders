---
import BaseLayout from '../layouts/BaseLayout.astro';
import InfluenceGraph from '../components/InfluenceGraph';
import { buildGraphData } from '../lib/data';

const { nodes, edges } = await buildGraphData(true);

// Transform to the format expected by the graph component
const graphNodes = nodes.map(n => ({
  id: n.id,
  name: n.name,
  kind: n.kind,
  domains: n.domains,
}));

// Get all unique domains for filter dropdown
const allDomains = [...new Set(nodes.flatMap(n => n.domains))].sort();

const graphEdges = edges.map(e => ({
  source: e.source,
  target: e.target,
  kind: e.kind,
  label: e.label,
  year: e.year,
}));
---

<BaseLayout title="Influence Graph">
  <h1>Influence Graph</h1>
  <p style="margin-bottom: 1.5rem; color: #666; max-width: 680px;">
    Trace the web of influence behind computing's greatest innovations.
    Use the search box to find any person, project, or institution, then explore their neighborhood.
  </p>

  <InfluenceGraph
    client:load
    nodes={graphNodes}
    edges={graphEdges}
    allDomains={allDomains}
  />
</BaseLayout>
